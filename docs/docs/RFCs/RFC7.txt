//RFC7: El periodo (en esta consulta MONTH) con la mayor cantidad de alojamientos ocupados
// RFC7: PARA MES, AÑO, DIA, HORA, MINUTO Y LA OFERTA ES DE HOTEL

SELECT PERIODO_CON_MAS_RESERVAS, CANTIDAD_RESERVAS FROM(
    SELECT PERIODO AS PERIODO_CON_MAS_RESERVAS, COUNT (PERIODO) AS CANTIDAD_RESERVAS, ROW_NUMBER() OVER (ORDER BY  COUNT (PERIODO) DESC)AS POSICION 
        FROM
            (SELECT IDRESERVA, EXTRACT(MONTH FROM FECHARESERVA)PERIODO FROM RESERVA INNER JOIN OFERTA ON RESERVA.IDOFERTA = OFERTA.IDOFERTA WHERE OFERTA.TIPODEOFERTA='OFERTAHOTEL') 
        GROUP BY PERIODO)
WHERE POSICION=1;


//RFC7: El periodo (en esta consulta MONTH) con la mayor cantidad de ingresos
//RFC7: PARA MES, AÑO, DIA, HORA, MINUTO Y LA OFERTA ES DE HOTEL

SELECT PERIODO_CON_MAS_INGRESOS, VALOR_TOTAL FROM (
    SELECT PERIODO AS PERIODO_CON_MAS_INGRESOS, VALOR_TOTAL, ROW_NUMBER() OVER (ORDER BY VALOR_TOTAL DESC)AS POSICION 
        FROM
            (SELECT PERIODO, SUM (VALOR_TOTAL_RESERVA) AS VALOR_TOTAL FROM
            (SELECT RESERVA.IDRESERVA, OFERTA.VALOR*OFERTA.DURACION AS VALOR_TOTAL_RESERVA, EXTRACT(MONTH FROM RESERVA.FECHARESERVA)PERIODO FROM (RESERVA INNER JOIN OFERTA ON RESERVA.IDOFERTA = OFERTA.IDOFERTA) 
            WHERE OFERTA.TIPODEOFERTA='OFERTAHOTEL') 
    GROUP BY PERIODO)
)WHERE POSICION=1;


//RFC7: El periodo (en esta consulta MONTH) con la menor cantidad de alojamientos ocupados
// RFC7: PARA MES, AÑO, DIA, HORA, MINUTO Y LA OFERTA ES DE HOTEL

SELECT PERIODO_CON_MENOS_RESERVAS, CANTIDAD_RESERVAS FROM(
    SELECT PERIODO AS PERIODO_CON_MENOS_RESERVAS, COUNT (PERIODO) AS CANTIDAD_RESERVAS, ROW_NUMBER() OVER (ORDER BY  COUNT (PERIODO) ASC)AS POSICION 
        FROM
            (SELECT IDRESERVA, EXTRACT(MONTH FROM FECHARESERVA)PERIODO FROM RESERVA INNER JOIN OFERTA ON RESERVA.IDOFERTA = OFERTA.IDOFERTA WHERE OFERTA.TIPODEOFERTA='OFERTAHOTEL') 
        GROUP BY PERIODO)
WHERE POSICION=1;